jQuery(document).ready(function(e){e.blockUI.defaults.overlayCSS.cursor="default",e.blockUI.defaults.overlayCSS.background="#fff",e.blockUI.defaults.overlayCSS.opacity=.6,e.blockUI.defaults.message=null;var t,n=e("#u_next_story_settings"),o=e("#u_next_story_rules_table");e(document).on("u_init_select",function(){e("select.u-init-select:not(.u-inited)").select2().addClass("u-inited"),e("#post_types").trigger("change")}).on("change","#apply_styles",function(t){e(this).is(":checked")?e("#styles-options").show():e("#styles-options").hide()}).on("change","#post_types",function(t){e(".post_type_taxonomy").prop("disabled",!0);let n=e(this).val();n.length&&e.each(n,function(t,n){e(".show_on_post_type_"+n).prop("disabled",!1)}),console.log(n)}).on("click","#add_new_rule",function(t){n.block(),e.ajax({type:"POST",url:uns_settings_params.ajax_url,dataType:"html",data:{action:"u_next_story_add_new_rule",security:uns_settings_params.default_nonce}}).done(function(t){e("tr",o).show(),e(".no-items",o).hide(),e(".edit-rule",o).length&&e(".edit-rule",o).remove(),e("tbody",o).append(t),e(document).trigger("u_init_select"),e(".color").wpColorPicker()}).fail(function(e){console.log("error")}).always(function(e){n.unblock()})}).on("click",".u-cancel-edit",function(t){var n=e(this).closest("tr").data("ruleid"),a=!!e('tr.u-rule-raw[data-ruleid="'+n+'"]').length&&e('tr.u-rule-raw[data-ruleid="'+n+'"]');!1!==a&&a.show(),e(".edit-rule",o).remove()}).on("click",".uns-edit-rule",function(t){var a=e(this).closest("tr"),l=a.data("ruleid");n.block(),e.ajax({type:"POST",url:uns_settings_params.ajax_url,dataType:"html",data:{action:"u_next_story_edit_rule",security:uns_settings_params.default_nonce,rule_id:l}}).done(function(t){e("tbody tr",o).not(".no-items").show(),e(".edit-rule",o).length&&e(".edit-rule",o).remove(),a.hide().after(t),e(document).trigger("u_init_select"),e(".color").wpColorPicker()}).fail(function(e){console.log("error")}).always(function(e){n.unblock()})}).on("click",".uns-delete-rule",function(t){var a=e(this).closest("tr"),l=a.data("ruleid");n.block(),e.ajax({type:"POST",url:uns_settings_params.ajax_url,dataType:"json",data:{action:"u_next_story_delete_rule",security:uns_settings_params.default_nonce,rule_id:l}}).done(function(t){a.remove(),e("tbody tr",o).not(".no-items").length||e(".no-items",o).show()}).fail(function(e){console.log("error")}).always(function(e){n.unblock()})}).on("submit","#edit-rule-form",function(t){var a=e(this).serialize(),l=e(this).closest("tr"),r=l.data("ruleid"),i=e('tr.u-rule-raw[data-ruleid="'+r+'"]').length?e('tr.u-rule-raw[data-ruleid="'+r+'"]'):l;return n.block(),e.ajax({type:"POST",url:uns_settings_params.ajax_url,dataType:"html",data:a+"&action=u_next_story_save_rule&security="+uns_settings_params.default_nonce}).done(function(t){i.replaceWith(t),e(".edit-rule",o).remove()}).fail(function(e){console.log("error")}).always(function(e){n.unblock()}),!1}),e("select.u-init-select:not(.u-inited)").length>0&&e(document).trigger("u_init_select"),e(".color").wpColorPicker(),jQuery.fn.uploadMediaFile=function(e,n){var o=e.attr("id"),a=o.replace("_button",""),l=o.replace("_button","_preview");t?t.open():((t=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!1})).on("select",function(){attachment=t.state().get("selection").first().toJSON(),jQuery("#"+a).val(attachment.id),n&&jQuery("#"+l).attr("src",attachment.sizes.thumbnail.url),t=!1}),t.open())},jQuery(".image_upload_button").click(function(){jQuery.fn.uploadMediaFile(jQuery(this),!0)}),jQuery(".image_delete_button").click(function(){return jQuery(this).closest("td").find(".image_data_field").val(""),jQuery(this).closest("td").find(".image_preview").remove(),!1})});
